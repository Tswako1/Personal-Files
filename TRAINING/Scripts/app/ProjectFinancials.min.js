(function(){this.ProjectFinancialsController=["$scope","$http","projectFinancials","notification","breadcrumb",function(n,t,i,r,u){var f,a,o,s,h,c,e,v,l;for(n.saveProjectFinancials=function(){if(n.projectFinancialsForm.$valid)return t.post("api/projectFinancials",{projectId:i.data[0].id,projectBudgets:h,projectActuals:f}),r("Successfully saved")},n.projectFinancials=i.data,n.sources=i.data[0].fundingSources,a=function(n,t){var u,r,i;for(i=new Date(n),u=new Date(t),r=[];i<=u;)r.push({year:i.getFullYear(),month:i.getMonth()+1}),i.setMonth(i.getMonth()+1);return r},s=a(i.data[0].startDate,i.data[0].endDate),h=n.sources.flatMap(function(n){return s.map(function(t){var r,u;return r=finYearPeriod(t.year,t.month),u=i.data[0].projectBudgets.first(function(t){return t.financialYear===r.finYear&&t.financialPeriod===r.finPeriod&&t.fundingSourceId===n.id}),u?(u.fundingSource=null,u):{financialYear:r.finYear,financialPeriod:r.finPeriod,fundingSourceId:n.id,amount:0}})}),f=s.map(function(n){var t,r;return t=finYearPeriod(n.year,n.month),r=i.data[0].projectActuals.first(function(n){return n.financialYear===t.finYear&&n.financialPeriod===t.finPeriod}),r?r:{financialYear:t.finYear,financialPeriod:t.finPeriod,amount:0}}),n.getActual=function(n,t){return f.first(function(i){return i.financialYear===parseInt(n)&&i.financialPeriod===parseInt(t)})},n.isInFuture=function(n){var t,i;return i=new Date,t=n.financialPeriod<7?new Date(n.financialYear-1,n.financialPeriod+5,1):new Date(n.financialYear,n.financialPeriod-6,1),t.setMonth(t.getMonth()+1),t>=i},n.calculatePeriodTotals=function(n){return this.$watch("month.value",function(){return n.total.amount=n.reduce(function(n,t){return parseFloat(t.amount)+n},0)},!0),n.total={amount:0}},n.calculateAnnualTotals=function(n,t){return this.$watch("year.value",function(){return n.total[t.id].amount=n.value.flatMap(function(n){return n.value}).filter(function(n){return n.fundingSourceId===t.id}).reduce(function(n,t){return parseFloat(t.amount)+n},0)},!0),n.total=n.total||{},n.total[t.id]={amount:0}},n.calculateTotalTotals=function(n){return this.$watch("year.value",function(){return n.budgetTotal.amount=n.value.flatMap(function(n){return n.value}).reduce(function(n,t){return parseFloat(t.amount)+n},0)},!0),n.budgetTotal={amount:0}},n.calculateActualTotals=function(t){return n.$watch("actuals",function(n){return t.actualsTotal.amount=n.filter(function(n){return n.financialYear===parseInt(t.key)}).reduce(function(n,t){return parseFloat(t.amount)+n},0)},!0),t.actualsTotal={amount:0}},n.actuals=f,c=[],l=h.groupBy(function(n){return n.financialYear}),e=0,v=l.length;e<v;e++)o=l[e],c.push({key:o.key,value:o.value.groupBy(function(n){return n.financialPeriod})});return n.financials=c,n.count=count,n.expandedYear=finYearPeriod((new Date).getFullYear(),(new Date).getMonth()+1).finYear,u([{description:i.data[0].name,url:"/projectRegistration/"+i.data[0].id},{description:"Financials"}])}]}).call(this)