(function(){var n;angular.module("mipmis").directive("date",["dateFilter","$parse","$timeout",function(n,t){return{restrict:"CA",priority:-1,link:function(i,r,u){var f=i.$watch(u.ngModel,function(r){return t(u.ngModel).assign(i,n(r,"yyyy/MM/dd"))});return r.datepicker({format:"yyyy/mm/dd",autoclose:!0}).on("changeDate",function(f){return i.$apply(function(){return t(u.ngModel).assign(i,n(f.date,"yyyy/MM/dd")),r.focus(),r.datepicker("hide")})})}}}]);angular.module("mipmis").directive("mycurr",["$filter","$parse",function(n){return{require:"ngModel",restrict:"A",link:function(t,i,r,u){var f;f=function(n,t){var r,i;return n?(r=n.toString().replace(/[^0-9.]+/g,"").replace(/\.{2,}/,"."),i=r.split("."),i.length>2?r=i[0]+"."+i[1].slice(0,2):i.length===2&&(r=i[0]+"."+i[1].slice(0,2)),t||u.$render(),r):n};u.$parsers.unshift(f);u.$render=function(){var t,e,r;if(console.log("viewValue",u.$viewValue),console.log("modelValue",u.$modelValue),t=f(u.$viewValue,!0),!t){i.val(t);return}e=void 0;r=t.split(".");e=t[t.length-1]==="."?n("number")(parseFloat(t))+".":t.indexOf(".")!==-1&&r[r.length-1].length===1?n("number")(parseFloat(t),1):t.indexOf(".")!==-1&&r[r.length-1].length===1?n("number")(parseFloat(t),2):n("number")(parseFloat(t));i.val(e)}}}}]);angular.module("mipmis").directive("toggle",[function(){return{restrict:"A",template:'<button ng-click="toggle = !toggle"><\/button>',replace:!0,scope:{toggle:"="}}}]);angular.module("mipmis").directive("ngModel",["$rootScope",function(n){return{restrict:"A",link:function(t,i,r){var u;return u={currency:"This field requires a valid currency amount. Please enter an amount in one of the following formats: 123456.78, 123 456.67",numeric:"This field requires a valid number.",date:"This field requires a valid date.",percentage:"This field requires a valid percentage."},i.after($("<div class='error'><\/div>").attr("validation-message",r.validationmessage||u[r.fieldtype]||"This field does not have a valid value.")),i.blur(function(){return i.addClass("blurred")}),i.focus(function(){return n.$broadcast("focus",i)})}}}]);n=["$scope","$document","documentType","foreignId","foreignType","documents","$http","parentScope","documentTypes","title","close",function(n,t,i,r,u,f,e,o,s,h,c){var a,l;l=null;a=!1;n.close=c;n.documentType=i;n.foreignId=r;n.foreignType=u;n.options={url:"upload/fileHandler"};n.documents=f.data;n.adddocument=function(n){return n.stopPropagation(),$("#add-file").click()};t.on("click",function(n){if(n.target===$(".modal.fade.in")[0])return t.off("click"),c.value.close()});return n.setqueue=function(n){return l=n},n.increment=function(){return o.numberOfDocuments=f.data.length+l.length},n.now=Date.now(),n.deletedocument=function(n){return e["delete"]("api/document/"+n.id).then(function(){return f.data.splice(f.data.indexOf(n),1),o.numberOfDocuments--})},n.documentTypeName=h||s.data.filter(function(n){return n.id===i})[0].description}];angular.module("mipmis").directive("documentManagement",["$rootScope",function(){return{controller:["$scope","$modal","$element",function(t,i){return t.open=function(r,u,f,e){var o;return o={},o.value=i.open({templateUrl:"content/views/documentUpload.html",controller:n,resolve:{documents:["$http",function(n){return n.get("api/document/?documentType="+r+"&foreignId="+u+"&foreignType="+f)}],documentType:function(){return r},foreignId:function(){return u},foreignType:function(){return f},parentScope:function(){return t},documentTypes:["$http",function(n){return n.get("lookup/DocumentTypes")}],title:function(){return e},close:function(){return o}}})}}],restrict:"C",link:function(){return 1},template:"<span class='project-documents' ng-click='open(documentType(),foreignId(),foreignType(),documentTitle)'>                <a  href=''><i class='icon-cabinet'><\/i>                <span ng-hide='numberOfDocuments==0' class='badge'>{{numberOfDocuments}}<\/span>                <\/a>                <\/span>",replace:!0,scope:{numberOfDocuments:"=documentCount",foreignId:"&foreignId",foreignType:"&foreignType",documentType:"&documentType",documentTitle:"@"}}}]);angular.module("mipmis").directive("select2",["$timeout",function(n){return{restrict:"A",link:function(t,i,r){return t.$watch(r.data,function(t){if(t)return n(function(){return i.select2()})})}}}]);angular.module("mipmis").directive("form",function(){return{restrict:"E",link:function(n,t){return t.bind("submit",function(){return t.addClass("submitted")})}}});angular.module("mipmis").directive("lookup",["$http",function(n){return{restrict:"A",scope:{id:"=id"},link:function(t,i,r){return n.get("lookup/"+r.lookup).then(function(n){var r;return r=n.data.filter(function(n){return n.id===t.id}),r.length>0?i.text(r[0].description):void 0})}}}]);angular.module("mipmis").directive("yesno",["$http",function(){return{restrict:"A",link:function(n,t,i){var r;return r=i.yesno==="true"?"Yes":"No",t.text(r)}}}]);angular.module("mipmis").directive("condition",["$http",function(){return{restrict:"A",link:function(n,t,i){return i.condition==="1"?t.addClass("One"):i.condition==="2"?t.addClass("Two"):i.condition==="3"?t.addClass("Three"):i.condition==="4"?t.addClass("Four"):i.condition==="5"?t.addClass("Five"):void 0}}}]);angular.module("mipmis").filter("periodNumberAsText",function(){var n;return n={1:"Jul",2:"Aug",3:"Sep",4:"Oct",5:"Nov",6:"Dec",7:"Jan",8:"Feb",9:"Mar",10:"Apr",11:"May",12:"Jun"},function(t){return n[t]}});angular.module("mipmis").filter("financialYear",function(){return function(n){return parseInt(n)-1+"/"+n.substring(2)}});angular.module("mipmis").factory("breadcrumb",["$rootScope","$route","$location",function(n,t,i){return function(t){var r;return n.breadcrumbs=function(){var n,f,u;for(u=[],n=0,f=t.length;n<f;n++)r=t[n],u.push({description:r.description,url:r.url||i.$$url});return u}()}}]);angular.module("mipmis").directive("placeholder",["$rootScope",function(n){return{restrict:"A",link:function(t,i,r){return n.$on("$routeChangeStart",function(){return i.html("")}),n.$on("placeholder:"+r.placeholder,function(n,t){return i.html(""),i.append(t)})}}}]);angular.module("mipmis").directive("placeholderContent",[function(){return{restrict:"A",transclude:!0,compile:function(n,t,i){return function(n){return i(n,function(i){return n.$emit("placeholder:"+t.placeholderContent,i)})}}}}]);angular.module("mipmis").directive("chart",["$http",function(){return{restrict:"A",template:'<div><svg height="300px"><\/svg><\/div>',scope:{values:"="},link:function(n,t){var r,u,f,e,o,i,s,h;return r=function(n,t){return t<7?new Date(n,t+6,1):new Date(n+1,t-6,1)},h=n.values.projectBudgets.groupBy(function(n){return r(n.financialYear,n.financialPeriod).toISOString()}),u=n.values.projectActuals.reduce(function(n,t){return n.concat({x:r(t.financialYear,t.financialPeriod),y:t.amount+n[n.length-1].y})},[{x:0,y:0}]),e=h.reduce(function(n,t){return n.concat({x:new Date(t.key),y:t.value.reduce(function(n,t){return n+t.amount},0)+n[n.length-1].y})},[{x:0,y:0}]),f={key:"Actuals",values:u.slice(1)},o={key:"Budgets",color:"red",values:e.slice(1)},s=[f,o],i=nv.addGraph(function(){var n;return n=t.find("svg")[0],i=nv.models.lineChart(),i.xAxis.axisLabel("Period").tickFormat(function(n){return d3.time.format("%Y/%m")(new Date(n))}),i.yAxis.axisLabel("Amount (R)").tickFormat(d3.format("R d")),d3.select(n).datum(s).transition().duration(500).call(i),i})}}}]);angular.module("mipmis").factory("operation",[function(){var n;return n={},access.map(function(t){return n[t]=!0}),function(t){return n[t]}}]);angular.module("mipmis").directive("operation",[function(){var n;return n={},access.map(function(t){return n[t]=!0}),{restrict:"A",link:function(t,i,r){if(!n[r.operation])return i.remove()}}}]);angular.module("mipmis").directive("bulletChart",[function(){return{restrict:"A",link:function(n,t,i){var r,u;return u=n.$eval(i.measures),r=n.$eval(i.markers),nv.addGraph(function(){var f;return f=nv.models.bulletChart(),d3.select(t[0]).datum({title:n.$eval(i.description),ranges:[0,Math.max(u,r)*1.1],measures:[u],markers:[r]}).transition().duration(1e3).call(f)})}}}]);angular.module("mipmis").directive("mipmisAccordion",[function(){return{restrict:"A",controller:["$scope",function(n){var t,i;return i=n.sections=[],t=null,this.add=function(n){return i.length===0&&(n.expanded=!0,t=n),i.push(n)},this.expand=function(n){return n.expanded=!0,t.expanded=!1,t=n}}],link:function(){}}}]);angular.module("mipmis").directive("accordionSection",[function(){return{restrict:"A",require:"^mipmisAccordion",transclude:!0,replace:!0,template:'<li ng-class="{expanded: expanded}"><h4 ng-click="expand()"><a href="{{href}}">{{description}}<\/a><\/h4><div ng-transclude><\/div><\/li>',scope:{description:"@accordionSection",href:"@"},link:function(n,t,i,r){return r.add(n),n.expand=function(){return r.expand(n)}}}}]);angular.module("mipmis").directive("calendar",["$compile",function(n){return{restrict:"A",replace:!0,link:function(t,i,r){var e,u,f,o;return f=new Date,o=f.getFullYear(),e=f.getMonth(),u=function(f,e){var y,s,p,c,l,a,v,o,w,h;i.html("");p=["January","February","March","April","May","June","July","August","September","October","November","December"];o=new Date(f,e,1);w=d3.time.month.offset(o,1);o.getDay()!==1&&(o=d3.time.day.utc.offset(o,-1*((o.getDay()===0?7:o.getDay())-1)));y=d3.time.day.utc.range(o,w);l=function(){return e<11?f:f+1};c=function(){return e<11?e+1:0};v=function(){return e>0?f:f-1};a=function(){return e>0?e-1:11};h=d3.select(i[0]).append("table").attr("class","month");s=h.append("thead").append("tr");s.append("th").attr("class","back").append("button").on("click",function(){return t.$eval(r.monthChange)(v(),a(),function(){return u(v(),a())})});s.append("th").attr("colspan","5").text(p[e]+" "+f);s.append("th").attr("class","forward").append("button").on("click",function(){return t.$eval(r.monthChange)(l(),c(),function(){return u(l(),c())})});return h.append("tbody").selectAll("tr").data(y.filter(function(n){return n.getDay()===1})).enter().append("tr").selectAll("td").data(function(n){return d3.time.day.utc.range(n,d3.time.day.offset(n,7))}).enter().append("td").on("click",function(n){return t.$apply(function(){return t.$eval(r.select)(n)})}).attr("pop",function(n){return n}).attr("class",function(n){return n.getMonth()===e?t.$eval(r.callback)(n):""}).text(function(n){return n.getMonth()===e?n.getDate():""}),n(h[0])(t)},r.$observe("callback",function(){return u(o,e)})}}}]);angular.module("mipmis").directive("node",[function(){var n;return n=!0,{restrict:"A",transclude:!0,replace:!0,scope:{value:"@",label:"@",organisations:"="},required:"node",controller:["$scope","$element","$timeout",function(t){var r,i;return i=[],t.state="none",t.state=t.value&&t.organisations&&t.organisations.indexOf(t.value)>=0?"all":"none",this.add=function(u){return t.hasChildren=!0,i.push(u),u.$watch("state",function(){var u,f;if(!r)return f=i.filter(function(n){return n.state==="none"}).length,u=i.filter(function(n){return n.state==="all"}).length,f===i.length?(n&&(t.collapsed=!0),t.state="none"):u===i.length?(n&&(t.collapsed=!1),t.state="all"):(n&&(t.collapsed=!1),t.state="some")})},r=!1,t.setStatus=function(n){var f,u,e;for(r=!0,t.state=n,u=0,e=i.length;u<e;u++)f=i[u],f.setStatus(t.state);return t.value&&n==="all"&&t.organisations.indexOf(t.value)<0&&t.organisations.push(t.value),t.value&&n==="none"&&t.organisations.indexOf(t.value)>=0&&t.organisations.splice(t.organisations.indexOf(t.value),1),r=!1},t.click=function(){return(n=!1,t.state==="none")?t.setStatus("all"):t.state==="all"?t.setStatus("none"):t.state==="some"?t.setStatus("all"):void 0}}],template:'<li ng-class="{leaf: !hasChildren, collapsed: collapsed}"><button class="expanded" toggle="collapsed"><\/button><button class="state" ng-class="state" ng-click="click()"><\/button><div ng-transclude><\/div><\/li>',link:function(n,t){var i;return i=t.parent().controller("node"),i?i.add(n):void 0}}}]);angular.module("mipmis").directive("popup",["$document","$rootScope","localStorageService",function(n,t,i){return{transclude:!0,template:'<div>                    <a href="" class="glyphicon glyphicon-user user-menu" ng-click="toggle($event)"/>                <\/div>                <div class="user-options" ng-show="isOpen" ng-click="$event.stopPropagation()">                    <div class="triangle"><\/div>                    <div ng-transclude><\/div>                    <div style="position: absolute; bottom: 10px; left: 10px" ng-hide="change">                        <button class="btn btn-default" ng-click="dismiss()">Dismiss<\/button>                    <\/div>                 <\/div>',scope:{change:"="},link:function(r){r.isOpen=!i.get("welcome.dismissed");r.dismiss=function(){return r.isOpen=!1,i.add("welcome.dismissed",!0)};r.toggle=function(n){return n.stopPropagation(),r.isOpen=!r.isOpen};return n.on("click",function(){if(r.isOpen&&!t.$$phase)return r.$apply(function(){return r.isOpen=!1})})}}}]);angular.module("mipmis").directive("fieldinfo",["$document","$rootScope","localStorageService",function(n,t,i){return{template:'<div class="glyphicon glyphicon-info-sign user-menu" ng-click="toggle($event)"><div ng-include="\'content/information/\' + file + \'.htm\'" ng-show="isOpen"><\/div><\/div>',scope:!0,link:function(r,u,f){r.file=f.fieldinfo;r.isOpen=!i.get("welcome.dismissed");r.dismiss=function(){return r.isOpen=!1,i.add("welcome.dismissed",!0)};r.toggle=function(n){return n.stopPropagation(),r.isOpen=!r.isOpen};return n.on("click",function(){if(r.isOpen&&!t.$$phase)return r.$apply(function(){return r.isOpen=!1})})}}}]);angular.module("mipmis").directive("coordinate",["$compile","$parse",function(n,t){return{link:function(i,r,u){var s,o,f,h,e;s=$('<button class="coordinate icon-arrow-down"><\/button>');e=$('<div class="coordinate-popup" ng-include="\'content/views/coordinate.html\'"><\/div>');r.after(s);r.after(e);s.on("click",function(){return e.toggleClass("open")});return f=i.$new(!0,i),f.dir=u.coordinate,n(e)(f),h=t(u.ngModel),f.values={},i.$watch(u.ngModel,function(){var t,n;return t=h(i),t?(n=parseFloat(t),f.values.deg=Math.floor(Math.abs(n)),f.values.min=Math.floor(Math.abs(n)*60)%60,f.values.sec=Math.abs(n)*3600%60):void 0}),o=function(){if(f.values.deg&&f.values.min&&f.values.sec)return h.assign(i,(u.coordinate==="S"?-1:1)*(parseFloat(f.values.deg)+parseFloat(f.values.min)/60+parseFloat(f.values.sec)/3600))},f.$watch("values.deg",o),f.$watch("values.min",o),f.$watch("values.sec",o),f.close=function(){return e.toggleClass("open")}}}}]);angular.module("mipmis").factory("mapElement",function(){return $("<div><\/div>").css("width","576px").css("height","400px")});angular.module("mipmis").factory("mapObject",["mapElement",function(n){var t;return t=n,new google.maps.Map(t[0],{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:9})}]);angular.module("mipmis").directive("map",["$timeout","mapElement","mapObject",function(n,t,i){return{scope:{long:"=",lat:"=",centerLat:"@",centerLong:"@"},link:function(r,u){var s,h,o,c,f,e,l,a;return e=null,c=u,c.append(t),s={lat:parseFloat(r.centerLat),long:parseFloat(r.centerLong)},l={center:new google.maps.LatLng(s.lat,s.long),zoom:9,mapTypeId:google.maps.MapTypeId.ROADMAP},f=i,n(function(){return google.maps.event.trigger(f,"resize")}),f.panTo(l.center),h=!1,o=0,google.maps.event.addListener(f,"dblclick",function(){return o=!0}),google.maps.event.addListener(f,"click",function(t){return n(function(){if(o){o=!1;return}return h=!0,e&&e.setMap(null),e=new google.maps.Marker({position:new google.maps.LatLng(t.latLng.lat(),t.latLng.lng()),title:"Location",map:f}),r.lat=t.latLng.lat(),r.long=t.latLng.lng(),h=!1},100)}),r.lat&&r.long&&(a=new google.maps.LatLng(r.lat,r.long),e=new google.maps.Marker({position:a,title:"Fault Location",map:f})),r.$on("$destroy",function(){return google.maps.event.clearListeners(f,"click"),google.maps.event.clearListeners(f,"dblclick"),e&&e.setMap(null),c.empty()})}}}])}).call(this)