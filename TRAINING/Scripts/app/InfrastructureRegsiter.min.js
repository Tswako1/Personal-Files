(function(){this.InfrastructureRegisterController=["$scope","$http","$modal","$routeParams","notification","organisations","criticalityGrades","conditions","assetClasses","sectorProgrammes","documentTypes","infrastructureRegister","breadcrumb",function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v,y,p;return v=function(){return n.infrastructureRegister.id?t.put:t.post},n.saveInfrastructureRegister=function(){if(n.infrastructureRegisterForm.$valid)return n.infrastructureRegister.purchasePrice=parseInt(n.priceOption)===0?n.price:0,n.infrastructureRegister.deemedCost=parseInt(n.priceOption)===1?n.price:0,v()("api/infrastructureRegister/",n.infrastructureRegister).then(function(t){return n.infrastructureRegister=t.data[0],u("Successfully saved")})},n.autoir=(l!=null?l.data[0]:void 0)?"IR-"+(l!=null?l.data[0].assetClass.code:void 0)+"-"+(l!=null?l.data[0].autoNumber:void 0):void 0,n.LookupSpatialData=function(){return t.get("api/spatial",{params:{longitude:n.infrastructureRegister.locationX,latitude:n.infrastructureRegister.locationY}}).then(function(t){return n.position=t.data})},n.getDocumentCount=function(t){var i;return i=n.infrastructureRegister.projectDocuments.filter(function(n){return n.documentType===t}),i.length?i[0].count:0},y=function(){return n.priceOption=n.infrastructureRegister.purchasePrice!==0?0:1,n.price=n.priceOption===0?n.infrastructureRegister.purchasePrice:n.infrastructureRegister.deemedCost},n.organisations=f.data,n.criticalityGrades=e.data,n.conditions=o.data,n.assetClasses=s.data,n.sectorProgrammes=h.data,n.documentTypes=c.data,a([{description:l!=null?l.data[0].description:void 0}]),n.infrastructureRegister=(l!=null?l.data[0]:void 0)||{},n.organisations.length!==1||n.infrastructureRegister.organisationId||(n.infrastructureRegister.organisationId=n.organisations[0].id),n.iswardselected=function(t){if(n.infrastructureRegister.wards.filter(function(n){return n.id===t.id}).length>0)return"selected"},n.$watch("selected",function(t){return n.infrastructureRegister.conditionId=t!=null?t.id:void 0}),n.$watch("infrastructureRegister.organisationId",function(i){return n.infrastructureRegister.organisationId&&(n.wards=t.get("lookup/Wards",{params:{id:i}})),n.infrastructureRegister.sectorProgrammeId?n.parentInfrastructureRegisters=t.get("lookup/InfrastructureRegistersByOrganisationAndSector",{params:{organisationId:n.infrastructureRegister.organisationId,sectorProgrammeId:n.infrastructureRegister.sectorProgrammeId}}):void 0}),n.$watch("infrastructureRegister.sectorProgrammeId",function(){if(n.infrastructureRegister.organisationId)return n.parentInfrastructureRegisters=t.get("lookup/InfrastructureRegistersByOrganisationAndSector",{params:{organisationId:n.infrastructureRegister.organisationId,sectorProgrammeId:n.infrastructureRegister.sectorProgrammeId}})}),p=new Date,n.$watch("infrastructureRegister.yearConstructedPurchaseDate",function(t){var i;return i=Date.parse(t),n.infrastructureRegisterForm.yearConstructedPurchaseDate.$setValidity("min",!t||i<=p)}),n.selectLocation=function(){var t;return t={},t.modal=i.open({templateUrl:"content/views/map.html",controller:mapController,resolve:{organisation:["$http",function(t){return t.get("faultReport/municipality/"+n.infrastructureRegister.organisationId)}],location:function(){return{lat:n.infrastructureRegister.locationY,long:n.infrastructureRegister.locationX}},dialog:function(){return t}}}),t.modal.result.then(function(t){if(t)return n.infrastructureRegister.locationX=t.long,n.infrastructureRegister.locationY=t.lat})},n.infrastructureRegister&&(n.selected=o.data.filter(function(t){return t.id===n.infrastructureRegister.conditionId}),n.selected=n.selected[0]),y()}]}).call(this)