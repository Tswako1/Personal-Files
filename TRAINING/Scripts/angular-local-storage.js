(function(){'use strict';var angularLocalStorage=angular.module('LocalStorageModule',[]);angularLocalStorage.provider('localStorageService',function(){this.prefix='ls';this.storageType='localStorage';this.cookie={expiry:30,path:'/'};this.notify={setItem:true,removeItem:false};this.setPrefix=function(prefix){this.prefix=prefix;};this.setStorageType=function(storageType){this.storageType=storageType;};this.setStorageCookie=function(exp,path){this.cookie={expiry:exp,path:path};};this.setStorageCookieDomain=function(domain){this.cookie.domain=domain;};this.setNotify=function(itemSet,itemRemove){this.notify={setItem:itemSet,removeItem:itemRemove};};this.$get=['$rootScope','$window','$document',function($rootScope,$window,$document){var prefix=this.prefix;var cookie=this.cookie;var notify=this.notify;var storageType=this.storageType;var webStorage=$window[storageType];if(!$document){$document=document;}
if(prefix.substr(-1)!=='.'){prefix=!!prefix?prefix+'.':'';}
var browserSupportsLocalStorage=(function(){try{var supported=(storageType in $window&&$window[storageType]!==null);var key=prefix+'__'+Math.round(Math.random()*1e7);if(supported){webStorage.setItem(key,'');webStorage.removeItem(key);}
return true;}catch(e){storageType='cookie';$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return false;}}());var addToLocalStorage=function(key,value){if(!browserSupportsLocalStorage){$rootScope.$broadcast('LocalStorageModule.notification.warning','LOCAL_STORAGE_NOT_SUPPORTED');if(notify.setItem){$rootScope.$broadcast('LocalStorageModule.notification.setitem',{key:key,newvalue:value,storageType:'cookie'});}
return addToCookies(key,value);}
if(typeof value==="undefined"){value=null;}
try{if(angular.isObject(value)||angular.isArray(value)){ value=angular.toJson(value);}
webStorage.setItem(prefix+key,value);if(notify.setItem){$rootScope.$broadcast('LocalStorageModule.notification.setitem',{key:key,newvalue:value,storageType:this.storageType});}}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return addToCookies(key,value);}
return true;};var getFromLocalStorage=function(key){if(!browserSupportsLocalStorage){$rootScope.$broadcast('LocalStorageModule.notification.warning','LOCAL_STORAGE_NOT_SUPPORTED');return getFromCookies(key);}
var item=webStorage.getItem(prefix+key);if(!item||item==='null'){return null;}
if(item.charAt(0)==="{"||item.charAt(0)==="["){return angular.fromJson(item);}
return item;};var removeFromLocalStorage=function(key){if(!browserSupportsLocalStorage){$rootScope.$broadcast('LocalStorageModule.notification.warning','LOCAL_STORAGE_NOT_SUPPORTED');if(notify.removeItem){$rootScope.$broadcast('LocalStorageModule.notification.removeitem',{key:key,storageType:'cookie'});}
return removeFromCookies(key);}
try{webStorage.removeItem(prefix+key);if(notify.removeItem){$rootScope.$broadcast('LocalStorageModule.notification.removeitem',{key:key,storageType:this.storageType});}}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return removeFromCookies(key);}
return true;};var getKeysForLocalStorage=function(){if(!browserSupportsLocalStorage){$rootScope.$broadcast('LocalStorageModule.notification.warning','LOCAL_STORAGE_NOT_SUPPORTED');return false;}
var prefixLength=prefix.length;var keys=[];for(var key in webStorage){if(key.substr(0,prefixLength)===prefix){try{keys.push(key.substr(prefixLength));}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.Description);return[];}}}
return keys;};var clearAllFromLocalStorage=function(regularExpression){regularExpression=regularExpression||"";var tempPrefix=prefix.slice(0,-1);var testRegex=new RegExp(tempPrefix+'.'+regularExpression);if(!browserSupportsLocalStorage){$rootScope.$broadcast('LocalStorageModule.notification.warning','LOCAL_STORAGE_NOT_SUPPORTED');return clearAllFromCookies();}
var prefixLength=prefix.length;for(var key in webStorage){if(testRegex.test(key)){try{removeFromLocalStorage(key.substr(prefixLength));}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return clearAllFromCookies();}}}
return true;};var browserSupportsCookies=function(){try{return navigator.cookieEnabled||("cookie" in $document&&($document.cookie.length>0||($document.cookie="test").indexOf.call($document.cookie,"test")>-1));}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return false;}};var addToCookies=function(key,value){if(typeof value==="undefined"){return false;}
if(!browserSupportsCookies()){$rootScope.$broadcast('LocalStorageModule.notification.error','COOKIES_NOT_SUPPORTED');return false;}
try{var expiry='',expiryDate=new Date(),cookieDomain='';if(value===null){expiryDate.setTime(expiryDate.getTime()+(-1*24*60*60*1000));expiry="; expires="+expiryDate.toGMTString();value='';}else if(cookie.expiry!==0){expiryDate.setTime(expiryDate.getTime()+(cookie.expiry*24*60*60*1000));expiry="; expires="+expiryDate.toGMTString();}
if(!!key){var cookiePath="; path="+cookie.path;if(cookie.domain){cookieDomain="; domain="+cookie.domain;}
$document.cookie=prefix+key+"="+encodeURIComponent(value)+expiry+cookiePath+cookieDomain;}}catch(e){$rootScope.$broadcast('LocalStorageModule.notification.error',e.message);return false;}
 return true;};var getFromCookies=function(key){if(!browserSupportsCookies()){$rootScope.$broadcast('LocalStorageModule.notification.error','COOKIES_NOT_SUPPORTED');return false;}
var cookies=$document.cookie&&$document.cookie.split(';')||[];for(var i=0;i<cookies.length;i++){var thisCookie=cookies[i];while(thisCookie.charAt(0)===' '){thisCookie=thisCookie.substring(1,thisCookie.length);}
if(thisCookie.indexOf(prefix+key+'=')===0){return decodeURIComponent(thisCookie.substring(prefix.length+key.length+1,thisCookie.length));}}
return null;};var removeFromCookies=function(key){addToCookies(key,null);};var clearAllFromCookies=function(){var thisCookie=null,thisKey=null;var prefixLength=prefix.length;var cookies=$document.cookie.split(';');for(var i=0;i<cookies.length;i++){thisCookie=cookies[i];while(thisCookie.charAt(0)===' '){thisCookie=thisCookie.substring(1,thisCookie.length);}
var key=thisCookie.substring(prefixLength,thisCookie.indexOf('='));removeFromCookies(key);}};var getStorageType=function(){return storageType;};return{isSupported:browserSupportsLocalStorage,getStorageType:getStorageType,set:addToLocalStorage,add:addToLocalStorage,get:getFromLocalStorage,keys:getKeysForLocalStorage,remove:removeFromLocalStorage,clearAll:clearAllFromLocalStorage,cookie:{set:addToCookies,add:addToCookies,get:getFromCookies,remove:removeFromCookies,clearAll:clearAllFromCookies}
};}];});}).call(this);